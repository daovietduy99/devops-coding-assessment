apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend
  labels:
    app: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: backend
  template:
    metadata:
      labels:
        app: backend
    spec:
      containers:
        - name: backend
          image: 571515939637.dkr.ecr.ap-southeast-1.amazonaws.com/backend:8ab474f
          ports:
            - containerPort: 5500
          env:
            - name: FLASK_ENV
              value: development
            - name: DB_HOST
              valueFrom:
                secretKeyRef:
                  name: backend
                  key: DB_HOST
            - name: DB_NAME
              valueFrom:
                secretKeyRef:
                  name: backend
                  key: DB_NAME
            - name: DB_USER
              valueFrom:
                secretKeyRef:
                  name: backend
                  key: DB_USER
            - name: DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: backend
                  key: DB_PASSWORD
          resources:
            limits:
              memory: "128Mi"
              cpu: "50m"
            requests:
              memory: "64Mi"
              cpu: "25m"
---
apiVersion: v1
kind: Service
metadata:
  name: backend
spec:
  ports:
    - port: 5500
      targetPort: 5500
  selector:
    app: backend
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: backend-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: backend
  minReplicas: 2
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 50
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: backend
  namespace: default
spec:
  encryptedData:
    DB_HOST: AgCoUUHexL7LhCQlj7adYXRBcWlKMjCqVrduVbSzjukbcV6CdEmq4KXOavttTl5gmwS1tcYxtV5rKjwX3+eo67CfScTTlv5IOKoEanERKJtiR5dSHbIO5sJniqu+olxOJkSvdMA4YPLiMM5srzMGLjenb7cKrtVxmVK3iQExbAcNVa0WLBppy2zSrMmqfHBJ3c7PKc1aur7N36UMZBVXUu+skVFcGHygZdUKITYlPrHGqoO+r8qzq/zoizXNwFVIhULGEu3S+OMykNctGkerIhazV+A/oirPjk5Qo61JhV1Cvp+AtDscySNl9RI5akW1oBchi3IoKsFUI/w+Y2c4KC5UTUDxI5+h9mgNsGejNx1hBD0Jd1ZsjlO+pIQStcQNw3SUuaUsWoptAlbXuFg1qM3qByRhQbskhZTblCQFbDMbqRvSOEirqR2dzuf0yt5wag6zDfIDDRG8OUNbifBkrbSvo7m7LyQ7SiouK9eAghDTXLQ3G+sSFn37ayisuPjXcftlO70ja4GNgHJvf9FQ24mNXi/Gtf5IjOmRzj+zQw8sTVI5D6IY1XfO1IfavI4zDTQ111rVH7/qYbkUKl/PY52eT3H6N5cqEMrHg1Av8lvCza6GRYAhu8+IlFdgI6ct0DoGc3VueihlZ+5UlCiNlMcEgwRWa+oJrOWEfCoVccga8zX1hbSb+z67P7cmdusp1NjuF717pyzCkE8=
    DB_NAME: AgBxSlw2w6BXEeQXoWusjYAvlLL0NF8XSx1pSFF4T1XvR2iyXeXKVmy5xisbzFCov+A1XQ2wMAUihSFfVBomANL5gscP2wCNsRix94c2OYqs/CUI/o7x49kgy3bvGlHWA9kHd2/jP4yaG8BLLRnz8OueL+XAouYRjr+DJSWS71dzAl0IrNRk64E2rqaQknM3W7GMZyMsrpJqC77MB1JFLucvbrlzcNsPvFW2d7flMBFErqsx2c9kACvvNxa1UrFXfz4fm+/3+9dfwOLuaIuy8ZZ6j68JVv+2KCZUzRa6rYuxq4p+BSzcHvkguhShD/C6xFJGgbbjpgLpkmJp3xEY+wLjZpgaHbY/4Sn7Ly/7HvBSlGsOIaOXdzowBHdOGJhQfaFQZrkGA0sVDTzuxNAGCHRL/6N8AJX/r5ZTw40OYZc4X52kmNsCJppC0VLESvfjI0njafo/P+nVT9Fm53S1aLrF9T9ni5GHKSidg1/reZAvhE85HeDrb2gs54JV+EvlHBJNTWF5DUWpbsLBzKBDHb2A1dXDP/7FLgwH2unH9VBXfT3pk0VPGajX34UtwE5zrCxKVUSIFP6BJkYJZGAlxirOR4HhE3HPVR8krYjWUabH50lbmMApo1udqnbyBy8NTitefpBmDtDvavfiB6uUd2Klb5iTxoOJJPWoI2yMTMx0l6Rt1k3TwSNeqOiTpKpG++ePfSVA9RDtVg==
    DB_PASSWORD: AgCYIwlwL0/TLXT1TMNcdLLoI+kVvyZQMqKHuzycGK0xniuvZHjEHxbz5Z+epxDGmCK7Jy5ryZtGv95D+4ILzg9an9SRfXhNVu7bn/+pkysazsty4dmpbw9vKiFUM3Fefn78zalizBsgmMs0GIkpO1NpLgg6IboxYLkdfeFgHJc7WQRoOaFk4BHnZRuwdU5JND3T2swvVzYJH4W6+smrf6xdDvBqo2238Ai8PnQpwM8XNSMrOSnHi2gMgtFtEHyGbIY3iahzFiMbQTr6Ez66zZTxCnlq9DEczyQWL7WwkV9XHOWkyFOMXvPGw3hxG4UE1fDatW3SK41x9zGy/GJhx/GvefzVbq3ZWQDCZPnUI3EiZxM92Aa5gxS+MWqpF2J/p4Dl/hhYleTTcmSwx4bwQH5P9t7IvLiM+2Rc5dPIqOSwDyiPo6zhaeXJzB5YFMy2Y88wZXGxWnU2hkCx+J6aGv8TeptvK6mJyC1S9aUlj4AcB01jW698PPkc2l3HWqO3bGIos4DrkN3GA7uD1LGJxrF6qW300ZK4agzzDKQSmG9K8eYr58ZN+RGl7oLCObfo5Lr88dcBfNP/2lC3QztnBDtO+8a7tc/YGcklX78c5lgsG94g/IRnhVu7AOAFHYdpvmeO7o8JKULHtGJCB9pmtAO6eLV8VwMRtzM53din5twg/9trzeUP1djGw0CStSXTx+calguZBCxxJIM=
    DB_USER: AgCh7/gg8+4vbMj9YEkh67vu25O2h7NKLYyIfeHaxlzPHzQe4L2EZyRx43Og0rfw/nlus0MFbyhYau8PuaA/MqU87kqizD1Ikd/ra2dLL5ajLOm53LpkZtQjeYdMwqkKxI+dHEwEdWpjIvfyX+nkqVGjIIG60befGNYczZgJT6RkTBb29RR4BjeKOLaNGCl2iFCb6/qseYFfllAYFszKnN5cgc3XKguL33GrfRgz10JopSWnwVEENDrCP0BFQATKN0DtpbsMUzAkDA2RQFR0gin4jwSKOMZKKAFF3oBA7pIo8MPrXfF6ClJi7sZwQof8c/RNh7O+dg7rXER8V1+ConXMIf/K4JH9eghVB2hbIXxM67zm/TKaoOcpNaoWD43R4KsYeh2UCqvaBbBbuydJpoprvJuDV8bHlmtXcHJR61MPwFBZlyLFmKD2EKbfDSJ8HJ4jRcgDSbTAzdUwkdm9Pfk1kVA5FuXuD5LeEkPe0qczrx7cKhLXvtTJACrKEaT9t+KsjCrKR0KO5XjTwb7PRO4Iim4moObVLGCE/7BJLMVRPZ/L3BxFPQaDF6S6pt5+pbMeqJptY5H1rgh27AYedz3b1KbpJWe1RBeL6YyxJfa7pynsK4Oe0pFRIfQ5OqKZ+rd83iFLNZnJndMRuX8pUXbjTox5IucejXjzNVjOLtvT1LNtBfy+ue7LelOmFkR7e58nMqY8FQ==
  template:
    metadata:
      creationTimestamp: null
      name: backend
      namespace: default
    type: Opaque
